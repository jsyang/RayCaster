<html><style>canvas {position:absolute; left:0; top:0;}</style><body></body><script src=gLayer.js></script><script>
/*------------------------------------------------------------------------------
"plasma effect"
------------------------------------------------------------------------------*/

// Simplify ImgData manipulation with these functions.
    function get(imgdata,i)
    {
        return [
            imgdata.data[i+0],
            imgdata.data[i+1],
            imgdata.data[i+2],
            imgdata.data[i+3]
        ];
    }
    
    function set(imgdata,i,RGB)
    {
        imgdata.data[i+0]=RGB[0];
        imgdata.data[i+1]=RGB[1];
        imgdata.data[i+2]=RGB[2];
        imgdata.data[i+3]=RGB[3]?RGB[3]:0xff;
    }
    
    function eq(RGB1,RGB2)
    {
        var equal=true;
        for(var i in RGB1)
        {
            equal &= RGB1[i]==RGB2[i];
        }
        return equal;
    }

// Normalize a vector
    function VNorm(v)
    {
        var length2=0;
        for(var i in v) length2+=v[i]*v[i];
        length2=Math.sqrt(length2);
        for(var i in v) v[i]/=length2;
        return v;
    }

// Scale a vector
    function VScale(v,s)
    {
        var v2=v.slice(0);
        for(var i in v2) v2[i]*=s;
        return v2;    
    }

// Sum 2 vectors
    function VSum(v1,v2)
    {
        var v3=v1.slice(0);
        for(var i in v3) v3[i]=v1[i]+v2[i];
        return v3;
    }

// Rotate along both x, y axis -- basically "mouse look"
    function RotateXY(v,xangle,yangle)
    {
        var cx=Math.cos(xangle);
        var sx=Math.sin(xangle);
        var cy=Math.cos(yangle);
        var sy=Math.sin(yangle);
            
        return [
            v[0]*cy+v[2]*sy,
            v[1]*cx+v[0]*sy*sx-v[2]*sx*cy,
            v[1]*sx-v[0]*sy*cx+v[2]*cx*cy
        ];    
    }

// When we're done loading the page, generate our plasma effect

var g=new gLayer([],[256,256],function(){setTimeout("drawPlasma(g.c)",200);});

// create the plasma palette so we can use it
var plasmaPalette=[];
for(var i=256; i-->0;)
{
    // 32,64,128
    plasmaPalette.push([
        (128 + 128 * Math.sin(3.1415 * i / 32)),
        (128 + 128 * Math.sin(3.1415 * i / 64)),
        (128 + 128 * Math.sin(3.1415 * i / 128))
    ]);
}

var paletteShift=0;

function drawPlasma(ctx)
{
    var ID_plasma=ctx.createImageData(256,256);
    
    
    for(var y=0; y<256; y++)
    {
        for(var x=0; x<256; x++)
        {
            var s=Math.sin;
            var c=(128+(128* s((x+y)/16)) + 128+(128*s((x-y)/16)))/2;
            /*var c=
                (128 + 128*s(x/16)) + 
                (128 + 128*s(Math.log(y)/8))  +
                (128 + 128*s((x-y)/16)) + 
                (128 + 128*s(Math.sqrt(x*x + y*y) / 8));
            c/=16;
			*/
            set(ID_plasma,(x+y*256)<<2,plasmaPalette[((c>>0)+paletteShift)%256]);
        }
    }
    
    ctx.putImageData(ID_plasma,0,0);
    paletteShift+=3;
    if(paletteShift>256) paletteShift=0;
}
                
setInterval("drawPlasma(g.c)",20);

</script></html>
